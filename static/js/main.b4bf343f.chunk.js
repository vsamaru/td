(this["webpackJsonpphotoframe-react"]=this["webpackJsonpphotoframe-react"]||[]).push([[0],{33:function(t,e,n){},34:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n(9),i=n.n(r),c=n(21),o=n(6),s=n(2),u=n.n(s),d=n(5),l=n(4),p=n(16),h=n.n(p),f=n(1),b=Object(a.createContext)();function j(t){var e=Object(a.useState)(),n=Object(l.a)(e,2),r=n[0],i=n[1],s=Object(a.useState)(),p=Object(l.a)(s,2),j=p[0],v=p[1],g=Object(a.useRef)(),m=Object(a.useState)(),O=Object(l.a)(m,2),y=O[0],x=O[1],w=Object(a.useState)([]),_=Object(l.a)(w,2),C=_[0],k=_[1],S=function(){var t=Object(d.a)(u.a.mark((function t(e,n){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.send({"@type":"sendMessage",chat_id:e,reply_to_message_id:0,input_message_content:{"@type":"inputMessageText",text:{"@type":"formattedText",text:n,entities:[]}}}));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),I=function(){var t=Object(d.a)(u.a.mark((function t(){var e,n,a,i=arguments;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=i.length>0&&void 0!==i[0]?i[0]:"9223372036854775807",n=i.length>1&&void 0!==i[1]?i[1]:0,a=i.length>2&&void 0!==i[2]?i[2]:50,t.abrupt("return",r.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:e,offset_chat_id:n,limit:a}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),z=function(){var t=Object(d.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",r.send({"@type":"getChat",chat_id:e}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),E=function(){var t=Object(d.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.send({"@type":"downloadFile",file_id:e,priority:1,synchronous:!0});case 2:return t.abrupt("return",r.send({"@type":"readFile",file_id:e}));case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),L=Object(a.useCallback)((function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100;r&&r.send({"@type":"getChatHistory",chat_id:t,limit:n,from_message_id:e}).then((function(t){return k((function(e){return Object(o.a)(new Set([].concat(Object(o.a)(t.messages),Object(o.a)(e)))).sort((function(t,e){return t.date-e.date}))}))}))}),[r]),P=Object(a.useCallback)((function(t){"updateAuthorizationState"===t["@type"]&&x(t),"updateNewMessage"!==t["@type"]&&"updateDeleteMessages"!==t["@type"]||function(t){var e;switch(t["@type"]){case"updateNewMessage":(null===t||void 0===t||null===(e=t.message)||void 0===e?void 0:e.chat_id)===g.current&&k((function(e){return[].concat(Object(o.a)(e),[null===t||void 0===t?void 0:t.message])}));break;case"updateDeleteMessages":t.chat_id===g.current&&t.message_ids.forEach(function(){var t=Object(d.a)(u.a.mark((function t(e){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:k((function(t){return t.filter((function(t){return t.id!==e}))}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}}(t)}),[]);return Object(a.useEffect)((function(){console.log("Initializing tdlib");var t=new h.a({useTestDC:!1,readOnly:!1,verbosity:3,jsVerbosity:3,fastUpdating:!0,useDatabase:!1,mode:"wasm"});t.onUpdate=P,i(t)}),[P]),Object(a.useEffect)((function(){r&&r.send({"@type":"setTdlibParameters",parameters:{"@type":"tdParameters",use_test_dc:!1,api_id:"3119646",api_hash:"05b8846cdaa773f23573156df8f26b1e",system_language_code:navigator.language||"en",device_model:"Telegram Frame",application_version:"0.1",use_secret_chats:!1,use_message_database:!1,use_file_database:!1,files_directory:"/"}})}),[r]),Object(a.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.send({"@type":"getChats",chat_list:{"@type":"chatListMain"},offset_order:"9223372036854775807",offset_chat_id:j,limit:1});case 2:L(j);case 3:case"end":return t.stop()}}),t)})))).apply(this,arguments)}r&&j&&(g.current=j,function(){t.apply(this,arguments)}())}),[r,j,L]),Object(f.jsx)(b.Provider,Object(c.a)({value:{client:r,chatId:j,setChatId:v,event:y,history:C,getChat:z,getChats:I,getChatHistory:L,sendTextMessage:S,downloadFile:E}},t))}function v(){var t=Object(a.useContext)(b);if(void 0===t)throw new Error("useTdlib must be used within a TelegramProvider");return t}var g=n(3),m=n(17),O=n.n(m),y=n.p+"static/media/tg_logo.eea735da.png",x=g.a.div({display:"grid",placeItems:"center",height:600,backgroundColor:"rgba(238, 243, 246, 0.8)"});function w(t){var e=t.event,n=v().client,r=Object(a.useRef)();return Object(a.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){var a,i;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:a=e.authorization_state["@type"],t.t0=a,t.next="authorizationStateClosed"===t.t0?4:"authorizationStateWaitEncryptionKey"===t.t0?8:"authorizationStateWaitPhoneNumber"===t.t0?11:"authorizationStateWaitOtherDeviceConfirmation"===t.t0?14:18;break;case 4:return t.next=6,n.send({"@type":"destroy"});case 6:return window.location.reload(),t.abrupt("break",19);case 8:return t.next=10,n.send({"@type":"checkDatabaseEncryptionKey"});case 10:return t.abrupt("break",19);case 11:return t.next=13,n.send({"@type":"requestQrCodeAuthentication",other_user_ids:[]});case 13:return t.abrupt("break",19);case 14:return i=new O.a({width:400,height:400,data:e.authorization_state.link,image:y,dotsOptions:{color:"#25abec",type:"square"},backgroundOptions:{color:"transparent"},imageOptions:{crossOrigin:"anonymous",margin:20}}),r.current.innerHTML="",i.append(r.current),t.abrupt("break",19);case 18:return t.abrupt("break",19);case 19:case"end":return t.stop()}}),t)})))).apply(this,arguments)}n&&(null===e||void 0===e?void 0:e.authorization_state)&&function(){t.apply(this,arguments)}()}),[n,e]),Object(f.jsxs)(x,{children:[Object(f.jsx)("h1",{children:"Login with your device"}),Object(f.jsx)("div",{ref:r})]})}var _=n(7);function C(t){var e=t.fileId,n=t.render,r=v().downloadFile,i=Object(a.useState)(),c=Object(l.a)(i,2),o=c[0],s=c[1];return Object(a.useEffect)((function(){var t=!0;function n(){return(n=Object(d.a)(u.a.mark((function n(){var a;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=2;break}return n.abrupt("return");case 2:return n.next=4,r(e);case 4:a=n.sent,t&&s(URL.createObjectURL(a.data));case 6:case"end":return n.stop()}}),n)})))).apply(this,arguments)}return function(){n.apply(this,arguments)}(),function(){return t=!1}}),[e,r]),n&&n({blob:o})}var k=g.a.div.withConfig({displayName:"RoundChatPicture",componentId:"sc-1urxdss-0"})((function(t){var e=t.size,n=void 0===e?100:e,a=t.src;return{height:n,width:n,borderRadius:"50%",backgroundImage:"url(".concat(a,")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundColor:"rgba(238, 243, 246, 0.8)"}})),S=g.a.div.withConfig({displayName:"ChatSelection__ListContainer",componentId:"sc-1r1tjet-0"})({scrollDirection:"vertical"}),I=g.a.ul.withConfig({displayName:"ChatSelection__List",componentId:"sc-1r1tjet-1"})({listStyle:"none",margin:0,padding:0}),z=g.a.li.withConfig({displayName:"ChatSelection__Chat",componentId:"sc-1r1tjet-2"})({padding:10,fontSize:"2rem","&:nth-child(odd)":{background:"rgba(238, 243, 246, 0.8)"}});function E(){var t=v(),e=t.client,n=t.getChat,r=t.getChats,i=t.setChatId,c=Object(a.useState)([]),s=Object(l.a)(c,2),p=s[0],h=s[1];return Object(a.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r();case 2:t.sent.chat_ids.map(function(){var t=Object(d.a)(u.a.mark((function t(e){var a;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n(e);case 2:a=t.sent,h((function(t){var n,r;return[].concat(Object(o.a)(t),[{id:e,title:a.title,chatPhotoId:null===a||void 0===a||null===(n=a.photo)||void 0===n||null===(r=n.small)||void 0===r?void 0:r.id}])}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e,n,r]),Object(f.jsxs)(S,{children:[Object(f.jsx)("h1",{children:"Select a chat to use as Frame:"}),Object(f.jsx)(I,{children:p.map((function(t){return Object(f.jsx)(z,{onClick:function(e){return i(t.id)},children:Object(f.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[Object(f.jsx)(C,{fileId:t.chatPhotoId,render:function(t){return Object(f.jsx)(k,{size:100,src:t.blob})}}),Object(f.jsx)("div",{style:{marginLeft:30},children:t.title})]})},t.id)}))})]})}var L=g.a.div.withConfig({displayName:"EmptyChat__Container",componentId:"jss9dm-0"})({display:"grid",placeItems:"center",height:"100vh"}),P=g.a.div.withConfig({displayName:"EmptyChat__Message",componentId:"jss9dm-1"})({fontSize:"2rem"});function N(){var t=v(),e=t.client,n=t.chatId,r=t.getChat,i=t.getChatHistory,c=Object(a.useState)(null),o=Object(l.a)(c,2),s=o[0],p=o[1],h=Object(a.useState)(),b=Object(l.a)(h,2),j=b[0],g=b[1];return Object(a.useEffect)((function(){n&&i&&i(n)}),[n,i]),Object(a.useEffect)((function(){var t=!0;function e(){return(e=Object(d.a)(u.a.mark((function e(){var a,i,c,o;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(n);case 2:c=e.sent,o=null===c||void 0===c||null===(a=c.photo)||void 0===a||null===(i=a.big)||void 0===i?void 0:i.id,t&&(p(c.title),g(o));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return function(){e.apply(this,arguments)}(),function(){return t=!1}}),[e,n,r]),Object(f.jsxs)(L,{children:[Object(f.jsx)(C,{fileId:j,render:function(t){return Object(f.jsx)(k,{size:400,src:t.blob})}}),Object(f.jsxs)(P,{children:["Send a picture to '",s,"' to view it here"]})]})}var R=g.a.div.withConfig({displayName:"Loading__Overlay",componentId:"sc-1ptxpaf-0"})({display:"grid",placeItems:"center",height:"100%",width:"100%",position:"fixed",top:0,right:0,zIndex:999,backgroundColor:"rgba(238, 243, 246, 0.8)",overflowX:"hidden"}),M=g.a.div.withConfig({displayName:"Loading__Container",componentId:"sc-1ptxpaf-1"})({padding:20,display:"grid",placeItems:"center",backgroundColor:"white",boxShadow:"0 0 16px 0 rgba(51,51,51,0.16)",height:150,width:150,borderRadius:"50%"});function D(t){var e=t.message,n=void 0===e?"Loading...":e;return i.a.createPortal(Object(f.jsx)(R,{children:Object(f.jsx)(M,{children:Object(f.jsx)("div",{children:n})})}),document.getElementById("modal-root"))}var T=n(14),F=g.a.button({padding:10,border:"none",font:"inherit",color:"inherit",backgroundColor:"light-grey",borderRadius:"50%",height:50,width:50,fontSize:"1.5rem",margin:5});function U(t){t.client;var e=t.text,n=t.children,a=v(),r=a.chatId,i=a.sendTextMessage,c=Object(T.a)("/pop-down.mp3",{volume:.25}),o=Object(l.a)(c,1)[0],s=Object(T.a)("/pop-up-on.mp3",{volume:.25}),u=Object(l.a)(s,1)[0];return Object(f.jsx)(F,{onMouseDown:o,onMouseUp:function(t){u(),function(t){i(r,t)}(e)},children:n})}var W=g.a.div.withConfig({displayName:"Slideshow__Container",componentId:"dxjitx-0"})({overflow:"hidden",height:600,width:1024,cursor:"none"}),H=g.a.div.withConfig({displayName:"Slideshow__Picture",componentId:"dxjitx-1"})((function(t){var e=t.blob;return{height:600,backgroundImage:"url(".concat(e,")"),backgroundPosition:"center",backgroundRepeat:"no-repeat",backgroundSize:"cover"}})),A=g.a.div.withConfig({displayName:"Slideshow__Caption",componentId:"dxjitx-2"})({position:"relative",top:-60,left:"2%",color:"white",fontSize:"2rem"}),B=g.a.div.withConfig({displayName:"Slideshow__Reactions",componentId:"dxjitx-3"})({position:"relative",top:"-15%",left:"85%",display:"flex",flexDirection:"row"});function K(){var t=v(),e=t.client,n=t.chatId,r=t.history,i=t.getChatHistory,c=t.downloadFile,o=Object(a.useState)(!0),s=Object(l.a)(o,2),p=s[0],h=s[1],b=Object(a.useState)(),j=Object(l.a)(b,2),g=j[0],m=j[1],O=Object(a.useState)(""),y=Object(l.a)(O,2),x=y[0],w=y[1];return Object(a.useEffect)((function(){function t(){return(t=Object(d.a)(u.a.mark((function t(){var e,n,a,i,o,s,d,l,p,b,j,v,g,O;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:h(!0),i=r.filter((function(t){var e;return["messagePhoto","messageVideo"].includes(null===t||void 0===t||null===(e=t.content)||void 0===e?void 0:e["@type"])})),Object(_.isEmpty)(i)&&m(Object(f.jsx)(D,{message:"No media in this chat..."})),o=Object(_.last)(i),t.t0=null===o||void 0===o||null===(e=o.content)||void 0===e?void 0:e["@type"],t.next="messagePhoto"===t.t0?7:"messageVideo"===t.t0?17:26;break;case 7:return s=o.content.photo,d=Object(_.last)(s.sizes),l=d.photo.id,t.next=12,c(l);case 12:return p=t.sent,b=URL.createObjectURL(p.data),m(Object(f.jsx)(H,{"data-testid":l,blob:b})),w(null===(n=o.content)||void 0===n?void 0:n.text),t.abrupt("break",27);case 17:return j=o.content.video,v=j.video.id,t.next=21,c(v);case 21:return g=t.sent,O=URL.createObjectURL(g.data),m(Object(f.jsx)("video",{"data-testid":v,src:O,controls:!0,autoPlay:!0})),w(null===(a=o.content)||void 0===a?void 0:a.text),t.abrupt("break",27);case 26:return t.abrupt("break",27);case 27:h(!1);case 28:case"end":return t.stop()}}),t)})))).apply(this,arguments)}!function(){t.apply(this,arguments)}()}),[e,r,n,i,c]),Object(f.jsxs)(W,{children:[p&&Object(f.jsx)(D,{}),g,Object(f.jsx)(A,{children:x}),Object(f.jsxs)(B,{children:[Object(f.jsx)(U,{client:e,text:"\u2665\ufe0f",children:"\u2665\ufe0f"}),Object(f.jsx)(U,{client:e,text:"\ud83e\udd70",children:"\ud83e\udd70"})]})]})}function V(){var t=v(),e=t.chatId,n=t.history;return e?Object(_.isEmpty)(n)?Object(f.jsx)(N,{}):Object(f.jsx)(K,{}):Object(f.jsx)(E,{})}n(32),n(33);var q=function(){var t=v(),e=t.client,n=t.event,a=t.updates;if(!n||!n.authorization_state)return Object(f.jsx)(D,{message:"Loading the app..."});switch(n.authorization_state["@type"]){case"authorizationStateWaitEncryptionKey":case"authorizationStateWaitOtherDeviceConfirmation":case"authorizationStateWaitPhoneNumber":case"updateAuthorizationState":case"authorizationStateClosed":return Object(f.jsx)(w,{event:n,client:e});case"authorizationStateReady":return Object(f.jsx)(V,{updates:a,client:e});default:return null}},J=function(t){t&&t instanceof Function&&n.e(4).then(n.bind(null,36)).then((function(e){var n=e.getCLS,a=e.getFID,r=e.getFCP,i=e.getLCP,c=e.getTTFB;n(t),a(t),r(t),i(t),c(t)}))};i.a.render(Object(f.jsx)(a.StrictMode,{children:Object(f.jsx)(j,{children:Object(f.jsx)(q,{})})}),document.getElementById("root")),J()}},[[34,1,2]]]);
//# sourceMappingURL=main.b4bf343f.chunk.js.map